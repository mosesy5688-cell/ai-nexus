name: Manual D1 Sync (Force Fix)
on:
  workflow_dispatch:

jobs:
  force-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install Wrangler
        run: npm install -g wrangler
      
      - name: Add Resources Column (if not exists)
        continue-on-error: true
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: "46307fa431173267a9c52d6954d5a2df"
        run: |
          echo "Adding resources column..."
          wrangler d1 execute ai-nexus-db --remote --command "ALTER TABLE models ADD COLUMN resources TEXT;"
          echo "Column added or already exists"
      
      - name: Execute SQL in Chunks
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          console.log('âœ… All statements executed successfully');
          "

