---
/**
 * GGUFList.astro
 * 
 * V15.0 Zone 4 Component
 * Displays available GGUF file variants (quantization levels) for a model.
 * 
 * @component
 */

interface Props {
  files?: any[];
  modelId?: string;
}

const { files = [], modelId } = Astro.props;

// Filter for .gguf files
const ggufFiles = files.filter(f => f.rfilename?.endsWith('.gguf'));
const hasFiles = ggufFiles.length > 0;

// Helper to extract quantization tag (e.g., Q4_K_M) from filename
const getQuant = (filename: string) => {
  const match = filename.match(/(Q\d+[A-Z0-9_]*)/i);
  return match ? match[1].toUpperCase() : 'UNKNOWN';
};

// Helper to format bytes
const formatSize = (bytes: number) => {
  if (!bytes) return '-';
  const gb = bytes / (1024 * 1024 * 1024);
  return `${gb.toFixed(2)} GB`;
};
---

{hasFiles && (
  <section class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden mb-8">
    <div class="p-6 border-b border-gray-100 dark:border-gray-700">
       <h2 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
         <span>üì¶</span> Available GGUF Files
       </h2>
       <p class="text-sm text-gray-500 mt-1">
         Optimized quantized versions for local inference (llama.cpp, Ollama, LM Studio).
       </p>
    </div>
    
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-900/50">
          <tr>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Filename</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantization</th>
            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size</th>
            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
          {ggufFiles.map((file) => (
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white font-mono">
                {file.rfilename}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                <span class="px-2 py-1 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs font-bold border border-blue-100 dark:border-blue-800">
                  {getQuant(file.rfilename)}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
                {formatSize(file.size)}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <a 
                  href={`https://huggingface.co/${modelId}/resolve/main/${file.rfilename}?download=true`}
                  target="_blank"
                  class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors"
                >
                  Download
                </a>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    
    <div class="bg-gray-50 dark:bg-gray-900/50 px-6 py-3 border-t border-gray-100 dark:border-gray-700">
        <p class="text-xs text-gray-500 flex items-center gap-2">
            <span>‚ÑπÔ∏è</span>
            <span>Files hosted on HuggingFace. Downloading incurs standard bandwidth usage.</span>
        </p>
    </div>
  </section>
)}
