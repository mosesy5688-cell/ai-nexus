---
/**
 * CommunityStats Component - Zone 2.5
 * V15.0: Display community engagement metrics
 */

interface Props {
  source?: string;
  sourceUrl?: string;
  likes?: number;
  downloads?: number;
  stars?: number;
  forks?: number;
  openIssues?: number;
}

const { source = 'huggingface', sourceUrl, likes = 0, downloads = 0, stars, forks, openIssues } = Astro.props;

function formatNum(num: number | undefined): string {
  if (!num) return '0';
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num.toString();
}

const isGitHub = source === 'github' && (stars || forks);
const isHuggingFace = source === 'huggingface' || (!isGitHub && (likes || downloads));
const hfDiscussionsUrl = sourceUrl ? `${sourceUrl}/discussions` : null;
const ghIssuesUrl = sourceUrl ? `${sourceUrl}/issues` : null;
const hasStats = (isHuggingFace && (likes > 0 || downloads > 0)) || (isGitHub && (stars || forks));
---

{hasStats && (
  <section class="community-stats-section bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-6 border border-purple-100 dark:border-purple-800/50">
    <div class="flex items-center gap-2 mb-3">
      <span class="text-lg">üë•</span>
      <h3 class="text-sm font-semibold text-purple-700 dark:text-purple-300">Community</h3>
    </div>
    
    <div class="grid grid-cols-2 gap-4">
      {isHuggingFace && (
        <div class="space-y-2">
          <div class="text-xs text-gray-500 dark:text-gray-400 font-medium">HuggingFace</div>
          <div class="flex gap-4">
            {likes > 0 && (
              <div class="flex items-center gap-1">
                <span class="text-red-500">‚ù§Ô∏è</span>
                <span class="font-semibold text-gray-900 dark:text-white">{formatNum(likes)}</span>
                <span class="text-xs text-gray-500">Likes</span>
              </div>
            )}
            {downloads > 0 && (
              <div class="flex items-center gap-1">
                <span class="text-blue-500">üì•</span>
                <span class="font-semibold text-gray-900 dark:text-white">{formatNum(downloads)}</span>
                <span class="text-xs text-gray-500">Downloads</span>
              </div>
            )}
          </div>
        </div>
      )}
      
      {isGitHub && (
        <div class="space-y-2">
          <div class="text-xs text-gray-500 dark:text-gray-400 font-medium">GitHub</div>
          <div class="flex gap-4 flex-wrap">
            {stars !== undefined && stars > 0 && (
              <div class="flex items-center gap-1">
                <span class="text-yellow-500">‚≠ê</span>
                <span class="font-semibold text-gray-900 dark:text-white">{formatNum(stars)}</span>
                <span class="text-xs text-gray-500">Stars</span>
              </div>
            )}
            {forks !== undefined && forks > 0 && (
              <div class="flex items-center gap-1">
                <span class="text-gray-600">üç¥</span>
                <span class="font-semibold text-gray-900 dark:text-white">{formatNum(forks)}</span>
                <span class="text-xs text-gray-500">Forks</span>
              </div>
            )}
            {openIssues !== undefined && openIssues > 0 && (
              <div class="flex items-center gap-1">
                <span class="text-green-500">üêõ</span>
                <span class="font-semibold text-gray-900 dark:text-white">{formatNum(openIssues)}</span>
                <span class="text-xs text-gray-500">Issues</span>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
    
    <div class="flex gap-3 mt-3 pt-3 border-t border-purple-200 dark:border-purple-700">
      {isHuggingFace && hfDiscussionsUrl && (
        <a href={hfDiscussionsUrl} target="_blank" rel="noopener noreferrer"
          class="text-xs text-purple-600 hover:text-purple-800 dark:text-purple-400 flex items-center gap-1">
          View HF Discussions <span class="text-[10px]">‚Üó</span>
        </a>
      )}
      {isGitHub && ghIssuesUrl && (
        <a href={ghIssuesUrl} target="_blank" rel="noopener noreferrer"
          class="text-xs text-purple-600 hover:text-purple-800 dark:text-purple-400 flex items-center gap-1">
          View GitHub Issues <span class="text-[10px]">‚Üó</span>
        </a>
      )}
    </div>
  </section>
)}
