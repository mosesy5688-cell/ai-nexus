---
/**
 * CodeExample.astro - Phase B.8
 * Displays code examples extracted from README
 * 
 * Constitution: Hide if no code (never show empty shell)
 * 
 * @component
 */

interface Props {
  code?: string;
  language?: string;
}

const { code, language = 'python' } = Astro.props;

// Don't render if no code
if (!code) return null;

// Full code display (Zero-Limit)
const displayCode = code;
const lines = displayCode.split('\n').length;
---

{code && (
  <section class="code-example bg-black rounded-xl overflow-hidden border border-gray-800 shadow-2xl">
    <div class="flex items-center justify-between px-4 py-2 bg-[#0a0a0a] border-b border-gray-800">
      <div class="flex items-center gap-2">
        <span class="text-yellow-400">ðŸ’»</span>
        <span class="text-xs font-black text-gray-400 uppercase tracking-widest">Quick Start</span>
        <span class="text-[10px] px-2 py-0.5 bg-gray-900 text-gray-500 rounded border border-gray-800 font-mono">{language}</span>
      </div>
      <button 
        class="copy-btn flex items-center gap-1.5 px-3 py-1 bg-white hover:bg-gray-200 text-black text-[11px] font-bold rounded-md transition-all active:scale-95 shadow-lg"
        data-code={code}
      >
        <span class="icon">ðŸ“‹</span>
        <span class="label">Copy Code</span>
      </button>
    </div>
    
    <pre class="p-5 overflow-x-auto text-sm leading-relaxed scrollbar-thin scrollbar-thumb-gray-800"><code class={`language-${language} text-white selection:bg-indigo-500/30`}>{displayCode}</code></pre>
    
    {lines > 50 && (
      <div class="px-4 py-2 bg-[#0a0a0a] border-t border-gray-800 text-[10px] text-gray-600 font-bold uppercase tracking-tighter">
        Scroll to view full implementation
      </div>
    )}
  </section>
)}

<script>
  // Copy button functionality
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const b = btn as HTMLButtonElement;
      const code = b.dataset.code || '';
      const label = b.querySelector('.label');
      const icon = b.querySelector('.icon');
      
      try {
          await navigator.clipboard.writeText(code);
          if (label) label.textContent = 'Copied!';
          if (icon) icon.textContent = 'âœ…';
          b.classList.replace('bg-white', 'bg-emerald-500');
          b.classList.add('text-white');
          
          setTimeout(() => {
            if (label) label.textContent = 'Copy Code';
            if (icon) icon.textContent = 'ðŸ“‹';
            b.classList.replace('bg-emerald-500', 'bg-white');
            b.classList.remove('text-white');
          }, 2000);
      } catch (err) {
          console.error('Failed to copy!', err);
      }
    });
  });
</script>

<style>
  .code-example pre {
    margin: 0;
    max-height: 500px;
  }
  
  .code-example code {
    font-family: 'Fira Code', 'JetBrains Mono', 'Monaco', monospace;
    font-variant-ligatures: normal;
  }

  /* Custom scrollbar for better visibility on black */
  .scrollbar-thin::-webkit-scrollbar {
    height: 6px;
    width: 6px;
  }
  .scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: #333;
    border-radius: 10px;
  }
</style>
