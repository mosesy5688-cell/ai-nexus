---
/**
 * ModelGallery.astro
 * 
 * V16.2: Automatic Image Extraction Gallery.
 * Scans markdown content for image links and displays them.
 */

interface Props {
  content: string;
  title?: string;
  className?: string;
}

const { content, title = "Visual Gallery", className = '' } = Astro.props;

// Enhanced Regex to find markdown images ! [alt] (url)
const imgRegex = /!\[.*?\]\((.*?)\)/g;
const imageUrls = [];
let match;

while ((match = imgRegex.exec(content)) !== null) {
  if (match[1] && !imageUrls.includes(match[1])) {
    imageUrls.push(match[1]);
  }
}

// Limit to first 6 images for performance
const displayImages = imageUrls.slice(0, 6);

if (displayImages.length === 0) return null;
---

<section class={`model-gallery-section py-8 ${className}`}>
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-xl font-black text-gray-900 dark:text-white flex items-center gap-3">
      <span class="p-2 bg-indigo-500/10 rounded-lg text-indigo-500">üñºÔ∏è</span>
      {title}
    </h2>
    <span class="text-[10px] font-mono text-gray-400 uppercase tracking-widest">
      {displayImages.length} Images Detected
    </span>
  </div>

  <div class="gallery-scroll flex gap-4 overflow-x-auto pb-6 scrollbar-thin scrollbar-thumb-gray-800 snap-x">
    {displayImages.map((src, index) => (
      <div class="gallery-item flex-none w-72 md:w-96 aspect-video rounded-2xl overflow-hidden bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-800 snap-start group cursor-zoom-in relative">
        <img 
          src={src} 
          alt={`Gallery image ${index + 1}`} 
          class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
          loading="lazy"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-4">
           <span class="text-[10px] text-white/80 font-mono truncate">{src.split('/').pop()}</span>
        </div>
      </div>
    ))}
  </div>
</section>

<style>
  .gallery-scroll {
    mask-image: linear-gradient(to right, black 85%, transparent 100%);
  }
  
  /* Custom scrollbar for better look */
  .gallery-scroll::-webkit-scrollbar {
    height: 4px;
  }
  .gallery-scroll::-webkit-scrollbar-thumb {
    background: #333;
    border-radius: 10px;
  }
</style>
