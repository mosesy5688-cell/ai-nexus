---
import RelationsPanel from './RelationsPanel.astro';
import RelatedKnowledge from './RelatedKnowledge.astro';
import BenchmarkCard from '../benchmark/BenchmarkCard.astro';
import MiniTrendChart from '../charts/MiniTrendChart.astro';
import SimilarModels from './SimilarModels.astro';

interface Props {
  model: any;
  tagsArray: string[];
  hasBench: boolean;
  modelId: string;
  modelName: string;
  similarModels: any[];
}

const { model, tagsArray, hasBench, modelId, modelName, similarModels } = Astro.props;
---

<div class="space-y-12">
    {/* 1. Knowledge Graph */}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
           <RelationsPanel
             baseModel={model?.base_model}
             datasetsUsed={model?.datasets_used || []}
             arxivRefs={model?.arxiv_refs || []}
           />
           <RelatedKnowledge 
             tags={tagsArray} 
             description={model?.description || ''}
             metaJson={model?.meta_json}
           />
        </div>
        <div class="space-y-6">
           {hasBench && (
             <BenchmarkCard 
               umid={modelId}
               name={modelName}
               mmlu={model?.mmlu || model?.benchmark_mmlu}
               humaneval={model?.humaneval || model?.benchmark_humaneval}
               hellaswag={model?.hellaswag || model?.benchmark_hellaswag}
               arc_challenge={model?.arc_challenge || model?.benchmark_arc}
               avg_score={model?.avg_score || model?.benchmark_avg || 0}
             />
           )}
           <div class="p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
              <h3 class="font-bold mb-4 text-gray-900 dark:text-white">7-Day Trend</h3>
              <MiniTrendChart 
                entityId={modelId} 
                width={400} 
                height={100} 
                initialData={model?.fni_trend_7d}
              />
           </div>
        </div>
    </div>

    {/* 2. Similar Models (Carousel) */}
    <div>
       <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <span>ðŸ”„ Similar Models</span>
       </h3>
       {similarModels.length > 0 ? (
          <SimilarModels models={similarModels} currentModelId={modelId} />
       ) : (
          <p class="text-gray-500 italic p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg text-center">No similar models found.</p>
       )}
    </div>
</div>
