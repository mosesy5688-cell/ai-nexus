---
/**
 * MarkdownRenderer.astro
 * 
 * B.6: Full README Display Component
 * Supports GFM Markdown + Images + Syntax Highlighting via 'marked'
 * V16.5: Refactored to external modules for Art 5.1 compliance (< 250 lines)
 * 
 * @component
 */
import { marked } from 'marked';
import '../../styles/markdown-premium.css';

interface Props {
  content: string;
  className?: string;
}

const { content, className = '' } = Astro.props;

// Clean and prepare content
let processedContent = content || '';

// Remove YAML frontmatter if present (V15.8: Resilient Regex)
processedContent = processedContent.replace(/^---\s*[\s\S]*?---\s*\n?/g, '');

// Convert markdown to HTML (server-side)
const renderedHtml = await marked.parse(processedContent);
---

<div class={`markdown-content prose prose-slate dark:prose-invert max-w-none 
            prose-headings:font-bold prose-a:text-indigo-600 dark:prose-a:text-indigo-400
            prose-pre:bg-[#0a0a0a] prose-pre:border prose-pre:border-gray-800
            prose-img:rounded-xl prose-img:shadow-lg ${className}`}
     set:html={renderedHtml}
/>

<script>
  import { initMarkdownCopy, initSmartTooltips, resolveImageUrls } from '../../scripts/markdown-controller.js';

  function run() {
    initMarkdownCopy();
    initSmartTooltips();
    resolveImageUrls();
  }

  // Initial load
  run();
  
  // Run on page transition if needed (Astro View Transitions)
  document.addEventListener('astro:after-swap', run);
</script>
