---
/**
 * SimilarModels Component - Zone 3
 * V15.0: Display ALT (Alternative) models as horizontal carousel
 * Data source: relations.json ALT edges
 */
interface SimilarModel {
  id: string;
  name: string;
  author?: string;
  fniScore?: number;
  downloads?: number;
  pipelineTag?: string;
}

interface Props {
  models: SimilarModel[];
  currentModelId?: string;
}

const { models = [], currentModelId } = Astro.props;

// Filter out current model and limit to 8
const displayModels = models
  .filter(m => m.id !== currentModelId)
  .slice(0, 8);

function formatNumber(num: number | undefined): string {
  if (!num) return '';
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num.toString();
}

function getModelUrl(model: SimilarModel): string {
  const slug = model.id.replace(/^model--/, '').replace(/--/g, '/');
  return `/model/${slug}`;
}
---

{displayModels.length > 0 && (
  <section class="similar-models-section bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm mb-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
        ðŸ”„ Similar Models
      </h2>
      <span class="text-xs text-gray-500 dark:text-gray-400">
        {displayModels.length} alternatives
      </span>
    </div>
    
    <div class="overflow-x-auto -mx-2 px-2 pb-2">
      <div class="flex gap-4" style="min-width: max-content">
        {displayModels.map(model => (
          <a href={getModelUrl(model)}
             class="flex-shrink-0 w-48 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all hover:shadow-md group">
            <div class="flex items-start justify-between mb-2">
              <span class="text-xs px-2 py-0.5 bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300 rounded">
                {model.pipelineTag || 'model'}
              </span>
              {model.fniScore && (
                <span class="text-xs font-bold text-emerald-600 dark:text-emerald-400">
                  {model.fniScore.toFixed(1)}
                </span>
              )}
            </div>
            
            <h3 class="font-medium text-gray-900 dark:text-white text-sm truncate group-hover:text-indigo-600 dark:group-hover:text-indigo-400">
              {model.name}
            </h3>
            
            {model.author && (
              <p class="text-xs text-gray-500 dark:text-gray-400 truncate mt-1">
                by {model.author}
              </p>
            )}
            
            {model.downloads && (
              <div class="flex items-center gap-1 mt-2 text-xs text-gray-500 dark:text-gray-400">
                <span>ðŸ“¥</span>
                <span>{formatNumber(model.downloads)}</span>
              </div>
            )}
          </a>
        ))}
      </div>
    </div>
    
    <style>
      .overflow-x-auto::-webkit-scrollbar {
        height: 6px;
      }
      .overflow-x-auto::-webkit-scrollbar-track {
        background: transparent;
      }
      .overflow-x-auto::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      .dark .overflow-x-auto::-webkit-scrollbar-thumb {
        background: #475569;
      }
    </style>
  </section>
)}
