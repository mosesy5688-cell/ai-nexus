---
import { generateEntityUrl } from '../../utils/url-utils.js';

interface SimilarModel {
  id: string;
  name: string;
  author?: string;
  fniScore?: number;
  downloads?: number;
  pipelineTag?: string;
  entity_type?: string;
}

interface Props {
  models: SimilarModel[];
  currentModelId?: string;
}

const { models = [], currentModelId } = Astro.props;

// Filter out current model
const displayModels = models
  .filter(m => m.id !== currentModelId);

function formatNumber(num: number | undefined): string {
  if (!num) return '';
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num.toString();
}
---

{displayModels.length > 0 && (
  <section class="similar-discovery-section pt-12 border-t border-zinc-100 dark:border-zinc-800 animate-slide-up" style="animation-delay: 0.3s;">
    <div class="flex items-center justify-between mb-8">
      <div class="flex items-center gap-3">
        <span class="text-xl">ðŸ”„</span>
        <h3 class="text-xs font-black text-zinc-900 dark:text-white uppercase tracking-[0.2em]">Neural Associations</h3>
      </div>
      <span class="text-[10px] font-black text-zinc-400 uppercase tracking-widest bg-zinc-50 dark:bg-zinc-900 px-2 py-1 rounded-md border border-zinc-100 dark:border-zinc-800">
        {displayModels.length} Related
      </span>
    </div>
    
    <div class="overflow-x-auto no-scrollbar -mx-4 px-4 pb-6 snap-x snap-mandatory">
      <div class="flex gap-5" style="min-width: max-content">
        {displayModels.map(item => (
          <a href={generateEntityUrl(item, item.entity_type || 'model')}
             class="flex-shrink-0 w-64 p-5 bg-white dark:bg-zinc-900 rounded-3xl border border-zinc-100 dark:border-zinc-800 hover:border-indigo-500/50 hover:shadow-xl hover:shadow-indigo-500/5 transition-all snap-start group relative overflow-hidden">
            
            <div class="flex items-start justify-between mb-4">
              <span class="text-[9px] font-black px-2 py-0.5 bg-zinc-50 dark:bg-zinc-800/50 text-zinc-400 dark:text-zinc-500 rounded uppercase tracking-tighter border border-zinc-100 dark:border-zinc-800">
                {item.pipelineTag || 'entity'}
              </span>
              {item.fniScore && (
                <div class="flex flex-col items-end">
                   <span class="text-[10px] font-black text-zinc-400 uppercase tracking-tighter">Rank</span>
                   <span class="text-xs font-black text-indigo-600 dark:text-indigo-400">
                     {item.fniScore.toFixed(0)}
                   </span>
                </div>
              )}
            </div>
            
            <h3 class="font-black text-zinc-900 dark:text-white text-sm tracking-tight leading-tight mb-2 truncate group-hover:text-indigo-600 transition-colors">
              {item.name}
            </h3>
            
            <div class="flex items-center justify-between mt-auto pt-4 border-t border-zinc-50 dark:border-zinc-800/50">
               <span class="text-[10px] font-bold text-zinc-400 truncate max-w-[120px]">
                  by {item.author || 'Community'}
               </span>
               {item.downloads && (
                 <div class="flex items-center gap-1 text-[10px] font-black text-zinc-500">
                   <span class="opacity-50">ðŸ“¥</span>
                   {formatNumber(item.downloads)}
                 </div>
               )}
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
)}

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
