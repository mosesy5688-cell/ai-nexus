---
/**
 * AiDisclaimer.astro
 * 
 * V8.1-LOCK Phase 2: Trust Protocol Component
 * DATA_DISCLOSURE_TRISTATE: Explicit data source disclosure
 * 
 * Displays disclaimer about data sources and freshness
 * 
 * @component
 */

interface Props {
  source?: string;          // e.g., 'huggingface', 'github', 'arxiv'
  lastUpdated?: string;     // ISO date string
  compact?: boolean;        // Compact mode for sidebar
}

const { source = 'huggingface', lastUpdated, compact = false } = Astro.props;

// Source display mapping with URLs for transparency
const sourceInfo: Record<string, { name: string; icon: string; color: string; url: string }> = {
  'huggingface': { name: 'Hugging Face', icon: 'ü§ó', color: 'yellow', url: 'https://huggingface.co' },
  'github': { name: 'GitHub', icon: 'üêô', color: 'gray', url: 'https://github.com' },
  'arxiv': { name: 'arXiv', icon: 'üìÑ', color: 'red', url: 'https://arxiv.org' },
  'civitai': { name: 'CivitAI', icon: 'üé®', color: 'purple', url: 'https://civitai.com' },
  'ollama': { name: 'Ollama', icon: 'ü¶ô', color: 'green', url: 'https://ollama.ai' },
  'replicate': { name: 'Replicate', icon: '‚ö°', color: 'blue', url: 'https://replicate.com' },
  'kaggle': { name: 'Kaggle', icon: 'üìä', color: 'cyan', url: 'https://kaggle.com' },
};

const info = sourceInfo[source?.toLowerCase()] || { name: source || 'Unknown', icon: 'üì¶', color: 'gray', url: '' };

// L1 Harvester sync frequency (Constitution compliant)
const syncFrequency = 'Daily';

// Format last updated
const formattedDate = lastUpdated 
  ? new Date(lastUpdated).toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'short', 
      day: 'numeric' 
    })
  : null;

// Color classes
const colorClasses: Record<string, string> = {
  'yellow': 'bg-yellow-50 border-yellow-200 text-yellow-800 dark:bg-yellow-900/20 dark:border-yellow-800 dark:text-yellow-200',
  'gray': 'bg-gray-50 border-gray-200 text-gray-800 dark:bg-gray-900/20 dark:border-gray-700 dark:text-gray-200',
  'red': 'bg-red-50 border-red-200 text-red-800 dark:bg-red-900/20 dark:border-red-800 dark:text-red-200',
  'purple': 'bg-purple-50 border-purple-200 text-purple-800 dark:bg-purple-900/20 dark:border-purple-800 dark:text-purple-200',
  'green': 'bg-green-50 border-green-200 text-green-800 dark:bg-green-900/20 dark:border-green-800 dark:text-green-200',
  'blue': 'bg-blue-50 border-blue-200 text-blue-800 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-200',
  'cyan': 'bg-cyan-50 border-cyan-200 text-cyan-800 dark:bg-cyan-900/20 dark:border-cyan-800 dark:text-cyan-200',
};

const classes = colorClasses[info.color] || colorClasses['gray'];
---

{compact ? (
  <!-- Compact version for sidebar -->
  <div class={`flex items-center gap-2 text-xs ${classes} px-2 py-1 rounded`}>
    <span>{info.icon}</span>
    {info.url ? (
      <a href={info.url} target="_blank" rel="noopener noreferrer" class="hover:underline">
        Data from {info.name}
      </a>
    ) : (
      <span>Data from {info.name}</span>
    )}
    {formattedDate && <span class="opacity-70">‚Ä¢ {formattedDate}</span>}
  </div>
) : (
  <!-- Full version with transparency info -->
  <div class={`${classes} border rounded-lg p-3 text-sm`}>
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center gap-2">
        <span class="text-lg">{info.icon}</span>
        {info.url ? (
          <a href={info.url} target="_blank" rel="noopener noreferrer" class="font-medium hover:underline">
            Data Source: {info.name} ‚Üó
          </a>
        ) : (
          <span class="font-medium">Data Source: {info.name}</span>
        )}
      </div>
      <span class="text-xs opacity-60">üîÑ {syncFrequency} sync (11:00 Beijing)</span>
    </div>
    <p class="opacity-80 text-xs">
      Based on open-source metadata snapshot.
      {formattedDate && <span> Last synced: {formattedDate}</span>}
    </p>
    <div class="flex items-center gap-3 mt-2 text-xs opacity-70">
      <a href="/methodology" class="hover:underline flex items-center gap-1">
        üìä <span>FNI Methodology</span>
      </a>
      <a href="/knowledge" class="hover:underline flex items-center gap-1">
        üìö <span>Knowledge Base</span>
      </a>
      <span class="italic">‚ÑπÔ∏è Verify with original source</span>
    </div>
  </div>
)}
