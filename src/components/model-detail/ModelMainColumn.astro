---
// src/components/model-detail/ModelMainColumn.astro
import FNITrustPanel from '../FNITrustPanel.astro';
import BenchmarkRawTable from '../benchmark/BenchmarkRawTable.astro';
import NeuralExplorer from '../NeuralExplorer.astro';
import ModelNotices from './ModelNotices.astro';
import ModelResources from './ModelResources.astro';
import EntityLinksSection from '../EntityLinksSection.astro';
import TechnicalSpecs from './TechnicalSpecs.astro';
import FullReadmeSection from './FullReadmeSection.astro';

interface Props {
  model: any;
  hasFNI: boolean;
  hasBenchmarkCap: boolean;
  modelName: string;
  modelId: string;
}

const { model, hasFNI, hasBenchmarkCap, modelName, modelId } = Astro.props;

// Extract meta_json fields
const metaJson = model.meta_json || {};
---

<div class="lg:col-span-2 space-y-8">
  <!-- FNI Trust Panel -->
  {hasFNI && (
    <FNITrustPanel 
      fniScore={model.fni_score || 0}
      fniPercentile={model.fni_percentile || 0}
      fniP={model.fni_p || 0}
      fniV={model.fni_v || 0}
      fniC={model.fni_c || 0}
      fniU={model.fni_u || 0}
      fniCommentary={model.fni_commentary || null}
      modelName={modelName}
      modelId={modelId}
    />
  )}
  
  <!-- Raw Benchmarks -->
  {hasBenchmarkCap && (
    <BenchmarkRawTable umid={modelId} />
  )}
  
  <NeuralExplorer model={{
    name: modelName,
    architecture: model.architecture || model.pipeline_tag,
    params_billions: model.params_billions,
    context_length: model.context_length,
    num_layers: model.num_layers,
    hidden_size: model.hidden_size
  }} />
  
  <!-- B.6: Technical Specifications from meta_json -->
  <TechnicalSpecs 
    pipelineTag={model.pipeline_tag || metaJson.pipeline_tag}
    libraryName={metaJson.library_name}
    params={model.params_billions || metaJson.params}
    storageBytes={metaJson.storage_bytes}
    filesCount={metaJson.files_count}
    gated={metaJson.gated}
    config={metaJson.config}
    architecture={model.architecture}
    contextLength={model.context_length}
    quantization={metaJson.quantization}
  />
  
  <!-- B.6: Full README/Model Card Section -->
  <FullReadmeSection 
    bodyContent={model.body_content || model.description}
    initialCollapsed={true}
    maxPreviewLength={3000}
  />
  
  <!-- Missing Data & Limitations -->
  <ModelNotices 
    entityLabel={model.entityDefinition?.display?.labelSingular || 'Model'}
    sourceUrl={model.source_url}
    sourceTrail={model.source_trail}
    license={model.license_spdx}
    hasDescription={!!model.description}
    hasSeoSummary={!!model.seo_summary}
  />
  
  <!-- Related Papers/Datasets -->
  <ModelResources 
    relatedPapers={model.related_papers}
    relatedDatasets={model.related_datasets}
  />
  
  <!-- Entity Links -->
  <EntityLinksSection modelId={modelId} modelName={modelName} />
</div>
