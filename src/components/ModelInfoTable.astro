---
// src/components/ModelInfoTable.astro
// SEO-optimized information table for Google Featured Snippets
// V16.5: Refactored for Constitutional Compliance (Art 5.1 - 250 line limit)
import ModelLineageSection from './model-detail/ModelLineageSection.astro';
import ModelTechSpecsSection from './model-detail/ModelTechSpecsSection.astro';

const { model } = Astro.props;

// V6.3: Derive display values with fallbacks
const displayName = model.displayName || model.name || model.canonical_name || 'Unknown Model';
const source = model.source || (model.slug?.startsWith('huggingface') || model.id?.startsWith('huggingface') ? 'Hugging Face' : model.slug?.startsWith('ollama') || model.id?.startsWith('ollama') ? 'Ollama' : 'Unknown');
---

<div class="mb-6 overflow-hidden rounded-xl border border-gray-200 dark:border-gray-700">
  <table class="w-full text-sm" itemscope itemtype="http://schema.org/Table">
    <caption class="sr-only">Model Information Summary</caption>
    <tbody class="divide-y divide-gray-200 dark:border-gray-700">
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
        <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50 w-1/3">Model Name</td>
        <td class="px-4 py-3 text-gray-700 dark:text-gray-300" itemprop="name">{displayName}</td>
      </tr>
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
        <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">Author</td>
        <td class="px-4 py-3 text-gray-700 dark:text-gray-300" itemprop="author">{model.author}</td>
      </tr>
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
        <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">Type</td>
        <td class="px-4 py-3 text-gray-700 dark:text-gray-300" itemprop="applicationCategory">
          {model.pipeline_tag || 'Not specified'}
        </td>
      </tr>
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
        <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">Downloads</td>
        <td class="px-4 py-3 text-gray-700 dark:text-gray-300">
          {model.downloads ? model.downloads.toLocaleString() : '0'}
        </td>
      </tr>
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
        <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">Likes</td>
        <td class="px-4 py-3 text-gray-700 dark:text-gray-300">
          {model.likes ? model.likes.toLocaleString() : '0'}
        </td>
      </tr>
      {model.license && (
        <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
          <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">License</td>
          <td class="px-4 py-3 text-gray-700 dark:text-gray-300" itemprop="license">{model.license}</td>
        </tr>
      )}
      {model.library_name && (
        <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
          <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">Library</td>
          <td class="px-4 py-3 text-gray-700 dark:text-gray-300" itemprop="softwareRequirements">{model.library_name}</td>
        </tr>
      )}
      <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
        <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">Source</td>
        <td class="px-4 py-3 text-gray-700 dark:text-gray-300 capitalize">{source}</td>
      </tr>
      {model.last_updated && (
        <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors">
          <td class="px-4 py-3 font-semibold text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-900/50">Last Updated</td>
          <td class="px-4 py-3 text-gray-700 dark:text-gray-300" itemprop="dateModified">
            {new Date(model.last_updated).toLocaleDateString('en-US', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            })}
          </td>
        </tr>
      )}

      {/* Modularized Lineage Info */}
      <ModelLineageSection model={model} />

      {/* Modularized Technical Specs */}
      <ModelTechSpecsSection model={model} />
      
    </tbody>
  </table>
</div>

<style>
  /* Ensure table is mobile-friendly */
  @media (max-width: 640px) {
    td {
      display: block;
      width: 100%;
    }
    td:first-child {
      border-bottom: none;
      padding-bottom: 0.5rem;
    }
    td:last-child {
      padding-top: 0.5rem;
    }
  }
</style>
