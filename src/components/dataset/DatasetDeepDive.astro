---
interface Props {
  dataset: any;
}

const { dataset } = Astro.props;
import FullReadmeSection from '../model-detail/FullReadmeSection.astro';
import QuickCommands from '../common/QuickCommands.astro';
import ModelGallery from '../model-detail/ModelGallery.astro';

// Helper for mock data generation if real data isn't available
const columns = dataset.features 
  ? Object.keys(dataset.features) 
  : ["feature", "label", "split"];

const mockRows = dataset.rows && dataset.rows.length > 0 
  ? dataset.rows 
  : [
      { feature: "example_text_1", label: 0, split: "train" },
      { feature: "example_text_2", label: 1, split: "train" },
      { feature: "example_text_3", label: 0, split: "test" },
      { feature: "example_text_4", label: 1, split: "validation" },
      { feature: "example_text_5", label: 0, split: "train" },
    ];

const configs = Array.isArray(dataset.configs) 
  ? dataset.configs 
  : (typeof dataset.configs === 'string' ? JSON.parse(dataset.configs) : []);


---

<div class="space-y-12">
  {/* V16.2: Universal Enhancements (Top) */}
  <section class="space-y-6">
     <QuickCommands entity={dataset} type="dataset" />
     <ModelGallery content={dataset.body_content || dataset.description} title="Dataset Preview & Visuals" />
  </section>

  <!-- Section: Data Preview & Schema (Grid) -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
     <section class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-sm border border-gray-100 dark:border-gray-700">
        <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white flex items-center gap-2">
           <span class="p-2 bg-blue-500/10 rounded-lg text-blue-500">üëÅÔ∏è</span> Data Preview
        </h2>
        
        <div class="overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-xl shadow-inner bg-gray-50/50 dark:bg-gray-900/50">
          <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700 font-mono text-[11px]">
            <thead class="bg-gray-50 dark:bg-gray-800">
              <tr>
                {columns.map(col => (
                  <th class="px-4 py-3 text-left text-[10px] font-black text-gray-400 uppercase tracking-widest">
                    {col}
                  </th>
                ))}
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
              {mockRows.map((row: any) => (
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                  {columns.map(col => (
                    <td class="px-4 py-3 whitespace-nowrap text-gray-600 dark:text-gray-400">
                      {col === 'label' ? (
                         <span class="px-2 py-0.5 rounded bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-200 font-bold">
                           {row[col]}
                         </span>
                      ) : (
                        row[col]?.toString()
                      )}
                    </td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <p class="mt-4 text-[10px] text-gray-400 italic font-medium tracking-tight">
          * Showing top 5 shards for structural validation. Full access restricted for anonymous nodes.
        </p>
     </section>

     <section class="bg-indigo-50/30 dark:bg-indigo-900/10 rounded-2xl p-8 border border-indigo-100 dark:border-indigo-800/20">
        <h2 class="text-xs font-black mb-8 text-indigo-900 dark:text-indigo-200 uppercase tracking-widest flex items-center gap-2">
           <span>üß¨</span> Field Logic
        </h2>
        <div class="space-y-6">
           <div class="font-mono text-xs space-y-4">
               <div class="p-3 bg-white dark:bg-gray-800 rounded-lg border border-indigo-100/50 dark:border-indigo-900/30 flex justify-between items-center">
                  <span class="text-purple-600 dark:text-purple-400 font-bold">feature</span>
                  <span class="text-gray-400">string</span>
               </div>
               <div class="p-3 bg-white dark:bg-gray-800 rounded-lg border border-indigo-100/50 dark:border-indigo-900/30 flex justify-between items-center">
                  <span class="text-purple-600 dark:text-purple-400 font-bold">label</span>
                  <span class="text-gray-400">int64</span>
               </div>
               <div class="p-3 bg-white dark:bg-gray-800 rounded-lg border border-indigo-100/50 dark:border-indigo-900/30 flex justify-between items-center">
                  <span class="text-purple-600 dark:text-purple-400 font-bold">split</span>
                  <span class="text-gray-400">string</span>
               </div>
           </div>

           {configs.length > 0 && (
              <div class="pt-6 border-t border-indigo-100 dark:border-indigo-800/30">
                 <h3 class="text-[10px] font-black text-gray-400 uppercase mb-4 tracking-widest">Available Configs</h3>
                 <div class="flex flex-wrap gap-1.5">
                   {configs.map((c: any) => (
                       <span class="px-2 py-0.5 bg-indigo-100 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300 rounded text-[10px] font-bold">
                         {c.config_name || c}
                       </span>
                   ))}
                 </div>
              </div>
           )}
        </div>
     </section>
  </div>

  <!-- Section: README / Dataset Card -->
  <div class="relative">
     <div class="absolute -left-6 top-10 w-1 bg-blue-500/20 h-24 rounded-full blur-sm"></div>
     <FullReadmeSection 
       bodyContent={dataset.body_content || dataset.description}
       type="dataset"
       initialCollapsed={false}
       maxPreviewLength={5000}
     />
  </div>
</div>
</div>
