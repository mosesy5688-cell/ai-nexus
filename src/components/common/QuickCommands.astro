---
/**
 * QuickCommands.astro
 * 
 * V16.2: Universal "Developer Fast-Path" component.
 * Provides copy-pasteable snippets for local deployment.
 */

interface Props {
  entity: any;
  type: 'model' | 'agent' | 'dataset' | 'paper' | 'space' | 'tool';
  className?: string;
}

const { entity, type, className = '' } = Astro.props;

// Logic for snippets
const id = entity?.id || entity?.umid || '';
const cleanId = id.split('--').pop()?.replace(/--/g, '/') || '';
const repoUrl = entity?.source_url || '';

const commands = [];

if (type === 'model') {
  // 1. Ollama (if likely compatible)
  if (entity.params_billions && entity.params_billions < 100) {
    commands.push({
      label: 'Ollama Run',
      cmd: `ollama run ${cleanId.includes('/') ? cleanId.split('/').pop() : cleanId}`,
      icon: 'ðŸ¦™'
    });
  }
  // 2. HF-CLI (Standard for Models)
  if (entity.source === 'huggingface' || repoUrl.includes('huggingface.co')) {
    commands.push({
      label: 'HF Download',
      cmd: `huggingface-cli download ${cleanId}`,
      icon: 'ðŸ¤—'
    });
  }
} else if (type === 'agent') {
  commands.push({
    label: 'GitHub Clone',
    cmd: `git clone ${repoUrl || '...' }`,
    icon: 'ðŸ™'
  });
} else if (type === 'dataset') {
  commands.push({
    label: 'HF Download',
    cmd: `huggingface-cli download --repo-type dataset ${cleanId}`,
    icon: 'ðŸ“Š'
  });
} else if (type === 'space') {
  const sdk = entity?.sdk?.toLowerCase() || 'gradio';
  commands.push({
    label: `Run with ${sdk.toUpperCase()}`,
    cmd: sdk === 'streamlit' ? 'streamlit run app.py' : 'python app.py',
    icon: 'ðŸš€'
  });
} else if (type === 'tool') {
  const lang = (entity?.language || '').toLowerCase();
  commands.push({
    label: 'Install',
    cmd: lang === 'javascript' || lang === 'typescript' ? `npm install ${cleanId.split('/').pop()}` : `pip install ${cleanId.split('/').pop()}`,
    icon: 'ðŸ“¦'
  });
} else if (type === 'paper') {
    const arxivId = entity?.arxiv_id || (id.includes('arxiv--') ? id.replace('arxiv--', '') : '');
    if (arxivId) {
        commands.push({
            label: 'BibTeX Citation',
            cmd: `gh arxiv cite ${arxivId}`,
            icon: 'ðŸ“œ'
        });
    }
}

// Global Source Check
if (repoUrl && repoUrl.includes('github.com') && commands.length < 2) {
    commands.push({
      label: 'Git Clone',
      cmd: `git clone ${repoUrl}`,
      icon: 'ðŸ™'
    });
}

if (commands.length === 0) return null;
---

<div class={`quick-commands-container space-y-4 ${className}`}>
  <h3 class="text-sm font-black text-gray-400 dark:text-gray-500 uppercase tracking-widest flex items-center gap-2">
    <span>âš¡</span> Quick Commands
  </h3>
  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    {commands.map(item => (
      <div class="command-box group relative bg-black border border-gray-800 rounded-xl overflow-hidden transition-all hover:border-indigo-500/50 shadow-2xl">
        <div class="flex items-center justify-between px-3 py-1.5 bg-[#0a0a0a] border-b border-gray-800">
           <span class="text-[10px] font-bold text-gray-500 flex items-center gap-1">
             <span>{item.icon}</span> {item.label}
           </span>
        </div>
        <div class="p-3 flex items-center justify-between gap-4">
          <code class="text-xs text-indigo-300 font-mono truncate">{item.cmd}</code>
          <button 
            class="copy-btn p-1.5 rounded-md hover:bg-white/10 text-gray-400 hover:text-white transition-colors active:scale-95"
            data-cmd={item.cmd}
            title="Copy to clipboard"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
            </svg>
          </button>
        </div>
      </div>
    ))}
  </div>
</div>

<script>
  function initQuickCopy() {
    document.querySelectorAll('.copy-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const b = btn as HTMLButtonElement;
        const cmd = b.dataset.cmd || '';
        try {
          await navigator.clipboard.writeText(cmd);
          const originalHtml = b.innerHTML;
          b.innerHTML = '<svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
          setTimeout(() => b.innerHTML = originalHtml, 2000);
        } catch (e) {}
      });
    });
  }
  initQuickCopy();
  document.addEventListener('astro:after-swap', initQuickCopy);
</script>
