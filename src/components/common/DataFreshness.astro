---
/**
 * DataFreshness Component
 * V4.4 Phase 3 - Shows when data was last updated
 */

interface Props {
  timestamp: string | null;
  source?: 'cdn' | 'kv' | 'fallback';
}

const { timestamp, source = 'cdn' } = Astro.props;

function formatDate(ts: string | null): string {
  if (!ts) return 'Unknown';
  try {
    const date = new Date(ts);
    return date.toLocaleString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      timeZoneName: 'short'
    });
  } catch {
    return ts;
  }
}

function getSourceIcon(src: string): string {
  switch (src) {
    case 'cdn': return '‚ö°';
    case 'kv': return 'üíæ';
    case 'fallback': return '‚ö†Ô∏è';
    default: return 'üìä';
  }
}
---

<div class="data-freshness">
  <span class="source-icon" title={`Data source: ${source}`}>
    {getSourceIcon(source)}
  </span>
  <span class="freshness-text">
    Updated: {formatDate(timestamp)}
  </span>
</div>

<style>
  .data-freshness {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.375rem 0.75rem;
    background: rgba(51, 65, 85, 0.5);
    border-radius: 9999px;
    font-size: 0.75rem;
    color: #94a3b8;
  }

  .source-icon {
    font-size: 0.875rem;
  }

  .freshness-text {
    font-family: 'JetBrains Mono', monospace;
  }
</style>
