---
interface Props {
  paper: any;
}

const { paper } = Astro.props;

// Mock BibTeX generation
const generateBibTeX = (p: any) => {
  const authorFirst = p.authors?.[0]?.split(' ').pop() || 'Unknown';
  const year = new Date(p.published_date || Date.now()).getFullYear();
  const id = `${authorFirst}${year}${p.title?.split(' ')[0] || 'Paper'}`;
  return `@article{${id},
  title={${p.title}},
  author={${p.authors?.join(' and ')}},
  journal={arXiv preprint arXiv:${p.id || '2401.xxxxx'}},
  year={${year}}
}`;
};

const bibtex = generateBibTeX(paper);
import FullReadmeSection from '../model-detail/FullReadmeSection.astro';
import QuickCommands from '../common/QuickCommands.astro';
import ModelGallery from '../model-detail/ModelGallery.astro';
---

<div class="space-y-8">
  <!-- Section: Abstract -->
  <section class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
    <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">
       <span>üìù</span> Abstract
    </h2>
    <p class="text-gray-800 dark:text-gray-200 leading-relaxed text-base font-serif">
      {paper?.abstract || 'Technical abstract for this publication is currently being indexed and will be available shortly.'}
    </p>
  </section>

  {/* V16.2: Universal Enhancements */}
  <ModelGallery content={paper.body_content || paper.abstract} title="Paper Figures & Visuals" />
  <QuickCommands entity={paper} type="paper" />

  <!-- Section: Citation / BibTeX -->
  <section class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
    <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">
       <span>‚ùù</span> Citation
    </h2>
     <div class="relative group">
        <pre class="bg-black text-white p-5 rounded-xl text-xs font-mono overflow-x-auto border border-gray-800 scrollbar-thin scrollbar-thumb-gray-800"><code>{bibtex}</code></pre>
        <button 
          class="absolute top-3 right-3 px-3 py-1 bg-white hover:bg-gray-200 text-black text-[10px] font-bold rounded-md opacity-0 group-hover:opacity-100 transition-all active:scale-95 shadow-lg border border-gray-200"
          onclick={`navigator.clipboard.writeText(\`${bibtex}\`).then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy', 2000); })`}
        >
          Copy
        </button>
     </div>
  </section>

  <!-- Section: Authors -->
  {paper.authors && paper.authors.length > 0 && (
    <section class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
      <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">
         <span>üë•</span> Authors
      </h2>
      <div class="flex flex-wrap gap-2">
        {paper.authors.map((author: string) => (
           <a href={`/search?q=${encodeURIComponent(author)}`} class="px-3 py-1.5 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-full text-sm hover:bg-blue-100 transition-colors">
             {author}
           </a>
        ))}
      </div>
    </section>
  )}
  <!-- Section: Full Abstract / Content -->
  <FullReadmeSection 
    bodyContent={paper.body_content || paper.abstract}
    type="paper"
    maxPreviewLength={2000}
  />
</div>
