---
// src/components/ModelHero.astro
// Priority ðŸ¥‡: Hero Section with Prominent CTAs
// Constraints: SSR only, no client JS, string safety enforced

interface Props {
  name: string;
  description?: string;
  author: string;
  likes: number;
  downloads: number;
  pipelineTag?: string;
  linksData?: string; // JSON string: {source_url, docs_url, demo_url}
}

const { 
  name, 
  description = '', 
  author, 
  likes, 
  downloads, 
  pipelineTag = '',
  linksData = '{}' 
} = Astro.props;

// Parse links data with defensive checks
let links = { source_url: '', docs_url: '', demo_url: '' };
try {
  if (linksData && typeof linksData === 'string') {
    const parsed = JSON.parse(linksData);
    if (parsed && typeof parsed === 'object') {
      links = {
        source_url: parsed.source_url || '',
        docs_url: parsed.docs_url || '',
        demo_url: parsed.demo_url || ''
      };
    }
  }
} catch (e) {
  console.warn('Failed to parse links_data:', e);
}

// Format numbers for display
const formatCount = (num: number): string => {
  if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M+`;
  if (num >= 1000) return `${(num / 1000).toFixed(1)}K+`;
  return num.toString();
};

// Determine if model is "popular" (>500K likes or downloads)
const isPopular = likes > 500000 || downloads > 500000;

// Extract first line of description as tagline
const tagline = description 
  ? description.split('\n')[0].substring(0, 120) 
  : `AI model by ${author}`;

// Generate initials for fallback icon
const initials = name
  .split(/[-_\/]/)
  .slice(0, 2)
  .map(word => word[0]?.toUpperCase() || '')
  .join('');
---

<div class="model-hero bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-900 rounded-xl p-8 mb-8 shadow-lg border border-blue-100 dark:border-gray-700">
  <div class="flex flex-col md:flex-row gap-6 items-start">
    
    <!-- Icon/Avatar -->
    <div class="flex-shrink-0">
      <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white text-2xl font-bold shadow-md">
        {initials}
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 min-w-0">
      <!-- Title Row with Popular Badge -->
      <div class="flex items-start gap-3 mb-2">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white leading-tight">
          {name}
        </h1>
        {isPopular && (
          <span class="inline-flex items-center gap-1 bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-1 rounded-full mt-1">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            Popular
          </span>
        )}
      </div>

      <!-- Tagline -->
      <p class="text-lg text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">
        {tagline}
      </p>

      <!-- CTAs Row -->
      <div class="flex flex-wrap gap-3 mb-4">
        {links.source_url && (
          <a 
            href={links.source_url} 
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            Download
          </a>
        )}
        
        {links.docs_url && (
          <a 
            href={links.docs_url}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 bg-white hover:bg-gray-50 text-blue-600 font-semibold px-6 py-3 rounded-lg border-2 border-blue-600 transition-all duration-200 shadow-sm hover:shadow-md"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
            Documentation
          </a>
        )}

        {links.demo_url && (
          <a 
            href={links.demo_url}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 bg-white hover:bg-gray-50 text-gray-700 font-semibold px-6 py-3 rounded-lg border-2 border-gray-300 transition-all duration-200 shadow-sm hover:shadow-md"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
            </svg>
            Try Demo
          </a>
        )}
      </div>

      <!-- Metadata Pills -->
      <div class="flex flex-wrap gap-2 text-sm text-gray-600 dark:text-gray-400">
        <span class="inline-flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
          </svg>
          {author}
        </span>
        
        {pipelineTag && (
          <span class="inline-flex items-center gap-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2.5 py-0.5 rounded-full">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
            </svg>
            {pipelineTag}
          </span>
        )}
        
        <span class="inline-flex items-center gap-1">
          <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
          </svg>
          <strong class="text-gray-900 dark:text-white">{formatCount(likes)}</strong>
        </span>
        
        <span class="inline-flex items-center gap-1">
          <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
          <strong class="text-gray-900 dark:text-white">{formatCount(downloads)}</strong>
        </span>
      </div>
    </div>
  </div>
</div>

<style>
  /* Micro-animations for CTAs */
  .model-hero a {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Dark mode support for gradient */
  @media (prefers-color-scheme: dark) {
    .model-hero {
      background: linear-gradient(to bottom right, #1f2937, #111827);
    }
  }
</style>
