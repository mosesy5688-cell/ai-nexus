---
/**
 * ExploreFilters Component
 * V5.1.2 - Refactored for CES Compliance
 * Advanced filtering with URL query sync
 */

import { families, sortOptions, sizeOptions, contextOptions } from '../../data/filter-options.js';
import FilterFamily from './filters/FilterFamily.astro';
import FilterRange from './filters/FilterRange.astro';
import FilterToggle from './filters/FilterToggle.astro';
import FilterSelect from './filters/FilterSelect.astro';

// Import Styles
import '../../styles/explore-filters.css';

interface Props {
  currentFilters: {
    family?: string;
    mmlu_min?: number;
    deploy_min?: number;
    has_benchmarks?: boolean;
    sort?: string;
    size?: string;
    context?: string;
  };
}

const { currentFilters } = Astro.props;

// Helper to split family string
const selectedFamilies = currentFilters.family ? currentFilters.family.split(',') : [];
---

<div class="explore-filters" id="explore-filters">
  <div class="filters-header">
    <h3>
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
      </svg>
      Filters
    </h3>
    <button class="btn-reset" id="reset-filters">Reset</button>
  </div>
  
  <div class="filters-grid">
    <!-- Architecture Family -->
    <FilterFamily families={families} selectedFamilies={selectedFamilies} />

    <!-- Model Size -->
    <FilterSelect 
      label="Model Size" 
      id="size-filter" 
      options={sizeOptions} 
      selectedValue={currentFilters.size || ''} 
    />

    <!-- Context Length -->
    <FilterSelect 
      label="Context Window" 
      id="context-filter" 
      options={contextOptions} 
      selectedValue={currentFilters.context || ''} 
    />

    <!-- Toggle Benchmarks -->
    <FilterToggle 
      label="Has Benchmarks" 
      id="benchmarks-toggle" 
      checked={!!currentFilters.has_benchmarks} 
    />

    <!-- MMLU Minimum -->
    <FilterRange 
      label="Min MMLU Score" 
      id="mmlu-min" 
      value={currentFilters.mmlu_min || 0}
    />

    <!-- Deploy Score Minimum -->
    <FilterRange 
      label="Min Deploy Score" 
      id="deploy-min" 
      value={(currentFilters.deploy_min || 0) * 100}
    />

    <!-- Sort Order -->
    <FilterSelect 
      label="Sort By" 
      id="sort-filter" 
      options={sortOptions} 
      selectedValue={currentFilters.sort || 'fni'} 
    />
  </div>

  <button class="btn-apply" id="apply-filters">
    Apply Filters
  </button>
</div>

<script>
  import { initializeFilters } from '../../scripts/filters-client.js';
  
  // V4.4 URL Query Protocol
  initializeFilters();
</script>
