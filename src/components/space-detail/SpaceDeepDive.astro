---
interface Props {
  space: any;
}

const { space } = Astro.props;
import FullReadmeSection from '../model-detail/FullReadmeSection.astro';

// Helper to determine install command based on SDK
const getInstallCommand = (sdk: string) => {
  switch (sdk?.toLowerCase()) {
    case 'gradio': return 'pip install gradio';
    case 'streamlit': return 'pip install streamlit';
    case 'docker': return 'docker pull ' + (space.name || 'image');
    default: return 'git clone ' + space.source_url;
  }
};
---

<div class="space-y-8">
  <!-- Section: Demo Preview -->
  <section class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
     <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">
       <span>ðŸŽ®</span> Demo Preview
     </h2>
     
     <div class="w-full aspect-video bg-gray-100 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden relative">
         {space.sdk === 'gradio' || space.sdk === 'streamlit' || space.sdk === 'docker' ? (
             <iframe 
                src={`https://hf.space/embed/${space.author}/${space.name}/+`} 
                class="w-full h-full" 
                frameborder="0"
                loading="lazy"
                title="Space Demo"
                sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
             ></iframe>
         ) : (
             <div class="flex flex-col items-center justify-center h-full p-6 text-center">
                <p class="text-gray-500 mb-4">Preview not available for {space.sdk || 'this SDK'}.</p>
                {space.source_url && (
                    <a href={space.source_url} target="_blank" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-medium">
                       Launch External Demo
                    </a>
                )}
             </div>
         )}
         <div class="absolute bottom-0 left-0 right-0 bg-black/80 text-white text-[10px] p-2 text-center border-t border-gray-800">
            Interact with caution. Content generated by third-party code.
         </div>
     </div>
  </section>

  <!-- Section: SDK Usage -->
  <section class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700">
      <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white flex items-center gap-2">
         <span>ðŸ’»</span> Usage
      </h2>
      <div class="space-y-4">
          <div>
            <label class="text-xs font-semibold text-gray-500 uppercase">Install SDK</label>
             <div class="mt-1 relative group">
                <div class="bg-black text-gray-300 p-4 rounded-xl font-mono text-xs flex justify-between items-center border border-gray-800 pr-16">
                   <code id="space-install-cmd">{getInstallCommand(space.sdk)}</code>
                </div>
                <button 
                  class="absolute top-2.5 right-2.5 px-3 py-1 bg-white hover:bg-gray-200 text-black text-[10px] font-bold rounded-md opacity-0 group-hover:opacity-100 transition-all active:scale-95 shadow-lg border border-gray-200"
                  onclick={`navigator.clipboard.writeText(document.getElementById('space-install-cmd').innerText).then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy', 2000); })`}
                >
                  Copy
                </button>
             </div>
          </div>
          <div>
             <label class="text-xs font-semibold text-gray-500 uppercase">Run Locally</label>
             <div class="mt-1 relative group">
                <div class="bg-black text-gray-300 p-4 rounded-xl font-mono text-xs border border-gray-800 pr-16">
                   <code id="space-clone-cmd">git clone https://huggingface.co/spaces/{space.author}/{space.name}</code>
                </div>
                <button 
                  class="absolute top-2.5 right-2.5 px-3 py-1 bg-white hover:bg-gray-200 text-black text-[10px] font-bold rounded-md opacity-0 group-hover:opacity-100 transition-all active:scale-95 shadow-lg border border-gray-200"
                  onclick={`navigator.clipboard.writeText(document.getElementById('space-clone-cmd').innerText).then(() => { this.textContent = 'Copied!'; setTimeout(() => this.textContent = 'Copy', 2000); })`}
                >
                  Copy
                </button>
             </div>
          </div>
      </div>
  </section>

  <!-- Section: README -->
  <FullReadmeSection 
    bodyContent={space.body_content || space.description}
    type="space"
    maxPreviewLength={2000}
  />
</div>
