---
/**
 * EntityShell.astro
 * V4.9 Entity-First Architecture
 * 
 * Universal entity rendering shell that replaces 5+ separate View files.
 * Art.X-Entity-Contract: Rendering MUST follow entity.definition
 * Art.X-Capability-Gating: UI modules enabled by capability only
 */

interface Props {
  entity: {
    id: string;
    type: string;
    slug: string;
    name: string;
    author?: string;
    description?: string;
    data: Record<string, any>;
  };
  definition: {
    type: string;
    capabilities: string[];
    display: {
      icon: string;
      color: string;
      labelSingular: string;
      labelPlural: string;
    };
    seoType: string;
  };
}

const { entity, definition } = Astro.props;

// Capabilities passed to EntityModules
import EntityModules from './EntityModules.astro';

// Color mapping for entity types
const colorMap: Record<string, string> = {
  blue: 'var(--color-primary, #3b82f6)',
  green: 'var(--color-success, #10b981)',
  orange: 'var(--color-warning, #f59e0b)',
  yellow: 'var(--color-accent, #eab308)',
  pink: 'var(--color-pink, #ec4899)',
  purple: 'var(--color-purple, #8b5cf6)',
  gray: 'var(--color-muted, #6b7280)',
  teal: 'var(--color-teal, #14b8a6)',
  indigo: 'var(--color-indigo, #6366f1)',
  red: 'var(--color-danger, #ef4444)'
};

const entityColor = colorMap[definition.display.color] || colorMap.blue;
---

<article class="entity-shell" data-entity-type={entity.type} data-entity-id={entity.id}>
  <!-- Entity Header (Universal) -->
  <header class="entity-header" style={`--entity-color: ${entityColor}`}>
    <div class="entity-type-badge">
      <span class="entity-icon">{definition.display.icon}</span>
      <span class="entity-type-label">{definition.display.labelSingular}</span>
    </div>
    
    <h1 class="entity-title">{entity.name}</h1>
    
    {entity.author && (
      <div class="entity-author">
        by <span class="author-name">{entity.author}</span>
      </div>
    )}
  </header>

  <!-- Capability-Gated Modules (Extracted to EntityModules.astro) -->
  <EntityModules entity={entity} definition={definition} />

  <!-- Entity Description (Universal) -->
  {entity.description && (
    <section class="entity-description">
      <slot name="description">
        <p>{entity.description}</p>
      </slot>
    </section>
  )}

  <!-- Entity Facts (Universal) -->
  <section class="entity-facts">
    <slot name="facts" />
  </section>

  <!-- Entity Relations (Art.X-Entity-Link) -->
  <section class="entity-relations">
    <slot name="relations" />
  </section>

  <!-- Custom Content Slot -->
  <slot />
</article>

<style>
  .entity-shell {
    --entity-color: var(--color-primary);
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 1.5rem;
  }

  .entity-header {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 2px solid var(--entity-color);
  }

  .entity-type-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0.75rem;
    background: color-mix(in srgb, var(--entity-color) 15%, transparent);
    border-radius: 999px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--entity-color);
    width: fit-content;
  }

  .entity-icon {
    font-size: 1.25rem;
  }

  .entity-title {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1.2;
    color: var(--text-primary, #1f2937);
    margin: 0;
  }

  .entity-author {
    font-size: 0.95rem;
    color: var(--text-muted, #6b7280);
  }

  .author-name {
    font-weight: 500;
    color: var(--entity-color);
  }



  .entity-description {
    margin-bottom: 2rem;
    line-height: 1.7;
    color: var(--text-secondary, #374151);
  }

  .entity-facts {
    margin-bottom: 2rem;
  }

  .entity-relations {
    margin-bottom: 2rem;
  }



  @media (max-width: 768px) {
    .entity-shell {
      padding: 1rem;
    }

    .entity-title {
      font-size: 1.5rem;
    }
  }
</style>
