---
/**
 * EntityModules.astro
 * Extracted from EntityShell.astro to reduce complexity (Art 1.4)
 */

interface Props {
  entity: {
    id: string;
    type: string;
    slug: string;
    name: string;
    data: Record<string, any>;
  };
  definition: {
    capabilities: string[];
  };
}

const { entity, definition } = Astro.props;

// Capability-gated module flags
const hasFNI = definition.capabilities.includes('fni');
const hasDeploy = definition.capabilities.includes('deploy');
const hasBenchmark = definition.capabilities.includes('benchmark');
const hasArchitecture = definition.capabilities.includes('architecture');
const hasCitations = definition.capabilities.includes('citations');
const hasOllama = definition.capabilities.includes('ollama');
const hasGGUF = definition.capabilities.includes('gguf');
---

<div class="entity-modules">
    
  <!-- FNI Module (Model only) -->
  {hasFNI && entity.data.fni_score != null && (
    <section class="entity-module module-fni">
      <slot name="fni">
        <div class="fni-placeholder">
          <span class="fni-score">{entity.data.fni_score?.toFixed(1) || 'N/A'}</span>
          <span class="fni-label">FNI Score</span>
        </div>
      </slot>
    </section>
  )}

  <!-- Deploy Module -->
  {hasDeploy && (
    <section class="entity-module module-deploy">
      <slot name="deploy">
        <div class="deploy-info">
          <span class="deploy-label">Deployment Info</span>
        </div>
      </slot>
    </section>
  )}

  <!-- Benchmark Module -->
  {hasBenchmark && (
    <section class="entity-module module-benchmark">
      <slot name="benchmark">
        <div class="benchmark-placeholder">
          <span class="benchmark-label">Benchmarks</span>
        </div>
      </slot>
    </section>
  )}

  <!-- Architecture Module (Neural Explorer) -->
  {hasArchitecture && (
    <section class="entity-module module-architecture">
      <slot name="architecture">
        <!-- Neural architecture visualization -->
      </slot>
    </section>
  )}

  <!-- Citations Module (Papers, Datasets) -->
  {hasCitations && (
    <section class="entity-module module-citations">
      <slot name="citations">
        <div class="citations-placeholder">
          <span class="citations-label">Citations & References</span>
        </div>
      </slot>
    </section>
  )}

  <!-- Ollama Module (Model only) -->
  {hasOllama && entity.data.has_ollama && (
    <section class="entity-module module-ollama">
      <slot name="ollama">
        <div class="ollama-badge">
          <span>ðŸ¦™ Available on Ollama</span>
        </div>
      </slot>
    </section>
  )}

  <!-- GGUF Module (Model only) -->
  {hasGGUF && entity.data.has_gguf && (
    <section class="entity-module module-gguf">
      <slot name="gguf">
        <div class="gguf-badge">
          <span>ðŸ“¦ GGUF Variants Available</span>
        </div>
      </slot>
    </section>
  )}
</div>

<style>
  .entity-modules {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .entity-module {
    padding: 1rem;
    background: var(--bg-secondary, #f9fafb);
    border-radius: 0.75rem;
    border: 1px solid var(--border-color, #e5e7eb);
  }

  .fni-placeholder,
  .deploy-info,
  .benchmark-placeholder,
  .citations-placeholder {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .fni-score {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--entity-color);
  }

  .ollama-badge,
  .gguf-badge {
    display: inline-flex;
    padding: 0.5rem 1rem;
    background: var(--bg-tertiary, #f3f4f6);
    border-radius: 0.5rem;
    font-weight: 500;
  }
</style>
