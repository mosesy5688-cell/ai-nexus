---
// src/components/ModelCarousel.astro
// Pure SSR implementation - no client-side JS required
export interface Props {
  models: any[];
}

const { models = [] } = Astro.props;

// Format number helper
const formatNumber = (num: number): string => {
  if (!num) return '0';
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
  return num.toString();
};
---

{models.length > 0 ? (
  <div class="relative group" id={`carousel-${models[0]?.id || 'default'}`}>
    <!-- Navigation Buttons -->
    <button 
      class="absolute left-0 top-1/2 -translate-y-1/2 -ml-4 z-20 bg-white dark:bg-gray-800 rounded-full p-2 shadow-lg border border-gray-100 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100 hidden md:flex"
      onclick="this.parentElement.querySelector('.carousel-container').scrollBy({left: -300, behavior: 'smooth'})"
      aria-label="Scroll Left"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
    </button>
    
    <button 
      class="absolute right-0 top-1/2 -translate-y-1/2 -mr-4 z-20 bg-white dark:bg-gray-800 rounded-full p-2 shadow-lg border border-gray-100 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100 hidden md:flex"
      onclick="this.parentElement.querySelector('.carousel-container').scrollBy({left: 300, behavior: 'smooth'})"
      aria-label="Scroll Right"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
    </button>

    <!-- Scroll Container -->
    <div class="carousel-container flex overflow-x-auto space-x-4 pb-4 snap-x snap-mandatory scrollbar-hide scroll-smooth">
      {models.map((model) => (
        <a 
          href={`/model/${model.slug || model.id.replace('/', '--')}`} 
          class="flex-none w-72 bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 snap-start border border-gray-100 dark:border-gray-700 block"
        >
          <!-- Content (No Image) -->
          <div class="p-5 flex flex-col h-full justify-between">
            <div>
                <h3 class="font-bold text-gray-900 dark:text-white truncate text-lg mb-1" title={model.name}>
                    {model.name}
                </h3>
                <p class="text-xs text-gray-500 dark:text-gray-400 truncate mb-4 flex items-center gap-1">
                    <span>by {model.author}</span>
                    {model.pipeline_tag && (
                        <span class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-1.5 py-0.5 rounded text-[10px] uppercase tracking-wider">
                            {model.pipeline_tag}
                        </span>
                    )}
                </p>
            </div>
            
            <div class="flex items-center justify-between mt-2 pt-3 border-t border-gray-100 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400">
              <div class="flex items-center gap-1" title={`${model.likes} likes`}>
                <span class="text-red-500">‚ù§Ô∏è</span>
                <span>{formatNumber(model.likes)}</span>
              </div>
              <div class="flex items-center gap-1" title={`${model.downloads} downloads`}>
                <span class="text-blue-500">üì•</span>
                <span>{formatNumber(model.downloads)}</span>
              </div>
            </div>
          </div>
        </a>
      ))}
    </div>
  </div>
) : (
  <p class="text-gray-500 italic">No related models found.</p>
)}

<style>
  /* Hide scrollbar for Chrome, Safari and Opera */
  .scrollbar-hide::-webkit-scrollbar {
      display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .scrollbar-hide {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;  /* Firefox */
  }
</style>
