---
import Layout from '@/layouts/Layout.astro';
import { marked } from 'marked';

// Using import.meta.glob is the modern, recommended way to import multiple files.
const reportModules = await import.meta.glob('../../data/report-archives/*.json');

export async function getStaticPaths() {
  const reports = await Promise.all(
    Object.values(reportModules).map(async (module) => {
      const report = await module();
      return report.default;
    })
  );

  return reports.map(report => ({
    params: { slug: report.reportId },
    props: { report },
  }));
}

const { report } = Astro.props;

const pageTitle = report.title;
const pageDescription = report.summary.substring(0, 160);

const contentHtml = marked.parse(report.content);
---

<Layout title={pageTitle} description={pageDescription}>
  <div class="container mx-auto px-4 py-12">
    <article class="prose dark:prose-invert max-w-4xl mx-auto">
      <Fragment set:html={contentHtml} />
    </article>
  </div>
</Layout>