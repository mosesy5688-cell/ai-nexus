---
import Layout from '@/layouts/Layout.astro';
import ReportCard from '@/components/ReportCard.astro';
import WeeklyTrendingSection from '@/components/WeeklyTrendingSection.astro';
import TrendChart from '@/components/charts/TrendChart.astro';
const reports = await Astro.glob('../../data/reports.json').then(res => res[0].default);

const latestReport = reports.length > 0 ? reports[0] : null;
const olderReports = reports.length > 1 ? reports.slice(1, 5) : [];

const pageTitle = "AI Industry Weekly Reports";
const pageDescription = "Stay updated with the latest trends, breakthroughs, and popular models in the open-source AI landscape with our weekly reports.";
---

<!-- V14.4 Art 5.6: News-style Reports Listing -->
<Layout title={pageTitle} description={pageDescription}>
  <div class="container mx-auto px-4 py-12">
    <header class="text-center mb-12">
      <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white">AI Industry Weekly Reports</h1>
      <p class="mt-4 text-lg text-gray-500 dark:text-gray-400">
        Your weekly digest of breakthroughs and trends in the open-source AI world.
      </p>
      <!-- V14.4 Art 5.5: Annual Reports link -->
      <div class="mt-4 flex justify-center gap-4">
        <a href="/reports/archive" class="text-blue-600 dark:text-blue-400 hover:underline">
          ðŸ“š Weekly Archive
        </a>
        <a href="/reports/annual" class="text-purple-600 dark:text-purple-400 hover:underline">
          ðŸ“Š Annual Reports
        </a>
      </div>
    </header>

    <!-- V4.8.1: Live Trending from L8 Cache -->
    <WeeklyTrendingSection />

    <!-- V12: Trend Charts Section -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold mb-6 text-gray-900 dark:text-white flex items-center gap-2">
        ðŸ“ˆ Model Ecosystem Trends
      </h2>
      <TrendChart type="line" height="350px" />
    </section>

    {latestReport ? (
      <div class="space-y-12">
        <!-- Latest Report -->
        <section class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg">
          <h2 class="text-3xl font-bold mb-2">{latestReport.title}</h2>
          <p class="text-gray-500 dark:text-gray-400 mb-6">{new Date(latestReport.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
          <p class="mb-8">{latestReport.summary}</p>
          <a href={`/reports/${latestReport.reportId}`} class="inline-block bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
            Read Full Report
          </a>
        </section>

        <!-- Older Reports -->
        {olderReports.length > 0 && (
          <section>
            <h3 class="text-2xl font-bold mb-6 text-center">Recent Reports</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              {olderReports.map(report => <ReportCard report={report} />)}
            </div>
            <div class="text-center mt-8">
              <a href="/reports/archive" class="text-blue-600 dark:text-blue-400 hover:underline font-semibold">
                View Full Archive &rarr;
              </a>
            </div>
          </section>
        )}
      </div>
    ) : (
      <p class="text-center text-gray-500 dark:text-gray-400 py-16">
        No weekly reports have been generated yet. Please check back later.
      </p>
    )}
  </div>
</Layout>