---
// src/pages/[keyword].astro
import KeywordPageLayout from '../layouts/KeywordPageLayout.astro';
import { getModels } from '../lib/data.ts';
import { CORE_KEYWORDS } from '../content/config.ts';

export async function getStaticPaths() {
  return CORE_KEYWORDS.map((keyword) => ({
    params: { keyword: keyword.slug },
  }));
}

const { keyword: keywordSlug } = Astro.params;
const currentKeyword = CORE_KEYWORDS.find(k => k.slug === keywordSlug);
const allModels = await getModels();

let filteredModels = [];
if (currentKeyword) {
  const matchTerms = currentKeyword.matchTerms;
  filteredModels = allModels.filter(model => {
    const modelTask = model.task?.toLowerCase() || '';
    const modelTags = (model.tags || []).map(t => t.toLowerCase());
    
    // Check if the model's task or any of its tags match any of the keyword's matchTerms
    return matchTerms.some(term => modelTask === term || modelTags.includes(term));
  });
}

const pageTitle = currentKeyword?.title || 'AI Models';
const pageDescription = currentKeyword?.description || `A curated list of AI models for ${keywordSlug}.`;
---

<KeywordPageLayout 
  title={pageTitle} 
  description={pageDescription} 
  models={filteredModels} 
  keyword={keywordSlug} 
/>
