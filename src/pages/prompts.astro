---
/**
 * AI Prompts Catalog (V4.1)
 * Optimized SSR + UniversalCatalog Engine
 */
import Layout from '../layouts/Layout.astro';
import ListingControls from '../components/common/ListingControls.astro';
import { fetchCatalogData, truncateListingItem } from '../utils/catalog-fetcher.js';
import CatalogCard from '../components/common/CatalogCard.astro';

// SSR Data Fetching
const { items: allPrompts = [], error } = await fetchCatalogData('prompt', Astro.locals.runtime?.env);
const prompts = allPrompts.slice(0, 48).map(truncateListingItem);

const pageTitle = "AI Prompts & Templates Catalog | Free2AI";
const pageDescription = "Discover top-tier AI system prompts, templates, and instructions for major LLMs.";

// V18.10.2: Explicit Edge Caching
Astro.response.headers.set('Cache-Control', 'public, s-maxage=3600, stale-while-revalidate=86400');
---

<Layout title={pageTitle} description={pageDescription}>
    <main class="max-w-[1400px] mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-black text-gray-900 dark:text-white mb-2 tracking-tighter uppercase">
                AI Prompts <span class="text-indigo-500">Templates</span>
            </h1>
            <p class="text-xs font-bold text-gray-400 dark:text-zinc-500 max-w-2xl uppercase tracking-widest">
                High-Resolution Catalog of Evaluated System Instructions
            </p>
        </header>

        <ListingControls type="prompt" searchId="prompts-search" />

        <div id="prompts-catalog-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-3">
            {prompts.length === 0 ? (
                <div class="col-span-1 sm:col-span-2 lg:col-span-4 xl:col-span-5 flex flex-col items-center justify-center py-16 px-4 bg-white dark:bg-zinc-900 border border-dashed border-gray-200 dark:border-zinc-800 rounded-lg animate-in fade-in duration-500">
                    <svg class="w-12 h-12 text-gray-300 dark:text-zinc-700 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m6.75 12l-3-3m0 0l-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"></path>
                    </svg>
                    <h3 class="text-sm font-bold text-gray-900 dark:text-white mb-2 uppercase tracking-wider">Awaiting Data Sync</h3>
                    <p class="text-xs text-gray-500 dark:text-zinc-500 text-center max-w-sm leading-relaxed">
                        The Prompt ecosystem data is currently pending indexing. The background pipeline will automatically populate this dashboard once the ingestion worker completes its cycle.
                    </p>
                </div>
            ) : (
                prompts.map((p: any) => (
                    <div class="animate-in fade-in slide-in-from-bottom-1 duration-300">
                        <CatalogCard item={p} type="prompt" />
                    </div>
                ))
            )}
        </div>

        <div id="pagination" class="mt-12 flex justify-center items-center gap-4"></div>
    </main>

    <script define:vars={{ initialData: prompts }}>
        window.__CATALOG_DATA__ = initialData;
    </script>

    <script>
        import { UniversalCatalog } from '../scripts/lib/UniversalCatalog.js';
        
        const init = () => {
            new UniversalCatalog({
                initialData: window.__CATALOG_DATA__ || [],
                type: 'prompt',
                gridId: 'prompts-catalog-grid',
                searchId: 'prompts-search',
                dataUrl: 'https://cdn.free2aitools.com/cache/rankings/prompt/p1.json'
            });
        };

        document.addEventListener('astro:page-load', init);
    </script>
</Layout>
