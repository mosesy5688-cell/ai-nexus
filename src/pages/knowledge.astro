---
/**
 * Knowledge Base Index Page
 * V12 UX Refresh - Premium design with improved contrast
 */

export const prerender = true;

import Layout from '../layouts/Layout.astro';
import KnowledgeCategoryCard from '../components/knowledge/KnowledgeCategoryCard.astro';
import MeshVisualizer from '../components/mesh/MeshVisualizer.astro';
import { KNOWLEDGE_CATEGORIES, getTotalArticleCount } from '../data/knowledge-base-config';

const pageTitle = "AI Knowledge Base - Free2AITools";
const pageDescription = "Learn about AI benchmarks, model architectures, and deployment. Comprehensive guides for MMLU, HumanEval, context length, and more.";
const totalArticles = getTotalArticleCount();
---

<Layout title={pageTitle} description={pageDescription}>
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Hero Section -->
    <header class="text-center mb-12 py-12 bg-gradient-to-br from-indigo-600/20 via-purple-600/10 to-pink-500/10 rounded-3xl border border-indigo-500/20">
      <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl mb-6 shadow-lg shadow-indigo-500/25">
        <span class="text-4xl">üìö</span>
      </div>
      <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 dark:text-white mb-4">
        AI Knowledge Base
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto mb-6">
        Comprehensive guides to understand AI models, benchmarks, and deployment strategies
      </p>
      <div class="flex items-center justify-center gap-6 text-sm">
        <div class="flex items-center gap-2 px-4 py-2 bg-indigo-100 dark:bg-indigo-900/40 rounded-full text-indigo-700 dark:text-indigo-300 font-medium">
          <span>üìÇ</span>
          <span>{KNOWLEDGE_CATEGORIES.length} Categories</span>
        </div>
        <div class="flex items-center gap-2 px-4 py-2 bg-purple-100 dark:bg-purple-900/40 rounded-full text-purple-700 dark:text-purple-300 font-medium">
          <span>üìù</span>
          <span>{totalArticles} Articles</span>
        </div>
      </div>
    </header>

    <!-- Quick Search -->
    <div class="max-w-xl mx-auto mb-12">
      <div class="relative">
        <input 
          type="text" 
          id="kb-search"
          placeholder="Search knowledge base..." 
          class="w-full px-6 py-4 pl-14 text-lg border-2 border-gray-200 dark:border-gray-700 rounded-2xl bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-lg shadow-gray-100 dark:shadow-none transition-all"
        />
        <div class="absolute inset-y-0 left-5 flex items-center pointer-events-none">
          <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
      </div>
    </div>

    <section class="mb-12">
      <MeshVisualizer />
    </section>

    <!-- Categories Grid -->
    <div class="categories-grid">
      {KNOWLEDGE_CATEGORIES.map(category => (
        <KnowledgeCategoryCard category={category} />
      ))}
    </div>



    <!-- Featured Articles -->
    <section class="mb-12 p-8 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl border border-gray-200 dark:border-gray-700">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
        ‚≠ê Popular Articles
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <a href="/knowledge/mmlu" class="group flex items-center gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:shadow-md transition-all">
          <span class="text-2xl">üìä</span>
          <div>
            <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400">MMLU Benchmark</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">Measuring multi-task accuracy</p>
          </div>
        </a>
        <a href="/knowledge/humaneval" class="group flex items-center gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:shadow-md transition-all">
          <span class="text-2xl">üíª</span>
          <div>
            <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400">HumanEval</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">Code generation evaluation</p>
          </div>
        </a>
        <a href="/knowledge/context-length" class="group flex items-center gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:shadow-md transition-all">
          <span class="text-2xl">üìè</span>
          <div>
            <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400">Context Length</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">Token limits explained</p>
          </div>
        </a>
        <a href="/knowledge/fni" class="group flex items-center gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600 hover:shadow-md transition-all">
          <span class="text-2xl">üõ°Ô∏è</span>
          <div>
            <h3 class="font-semibold text-gray-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400">FNI Score</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400">Freshness-Novelty Index</p>
          </div>
        </a>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="text-center py-12 px-8 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl text-white">
      <h2 class="text-2xl font-bold mb-3">Ready to explore models?</h2>
      <p class="text-indigo-100 mb-6 max-w-lg mx-auto">
        Apply your knowledge to find the perfect AI model for your use case
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="/ranking" class="px-8 py-3 bg-white text-indigo-600 font-semibold rounded-xl hover:bg-gray-100 transition-colors shadow-lg">
          üìä View Rankings
        </a>
        <a href="/models" class="px-8 py-3 bg-indigo-700 text-white font-semibold rounded-xl hover:bg-indigo-800 transition-colors border border-indigo-500">
          üîç Browse Models
        </a>
      </div>
    </section>
  </div>
</Layout>

<script is:inline>
  (function() {
      const STORAGE_KEY = 'f2ai_kb_progress';
      
      function hydrateProgress() {
          let progress = {};
          try {
              progress = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
          } catch (e) {}

          Object.keys(progress).forEach(slug => {
              const el = document.getElementById(`status-${slug}`);
              if (el) el.classList.remove('hidden');
          });
      }

      // Initial load
      hydrateProgress();

      // Listen for updates from other tabs or components
      window.addEventListener('storage', (e) => {
          if (e.key === STORAGE_KEY) hydrateProgress();
      });
      
      // Search functionality
      const searchInput = document.getElementById('kb-search');
      if (searchInput) {
          searchInput.addEventListener('input', (e) => {
              const query = e.target.value.toLowerCase().trim();
              const categoryCards = document.querySelectorAll('.category-card');
              
              categoryCards.forEach(card => {
                  const articles = card.querySelectorAll('.article-item');
                  let visibleArticles = 0;
                  
                  articles.forEach(article => {
                      const title = article.querySelector('.article-title')?.textContent?.toLowerCase() || '';
                      const desc = article.querySelector('.article-description')?.textContent?.toLowerCase() || '';
                      
                      if (title.includes(query) || desc.includes(query)) {
                          article.classList.remove('hidden');
                          visibleArticles++;
                      } else {
                          article.classList.add('hidden');
                      }
                  });
                  
                  // Hide category if no articles match
                  if (visibleArticles === 0 && query !== '') {
                      card.classList.add('hidden');
                  } else {
                      card.classList.remove('hidden');
                  }
              });
          });
      }

      window.addEventListener('kb-progress-updated', hydrateProgress);
  })();
</script>

<style>
  .categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
  }

  /* Search transition */
  .category-card, .article-item {
    transition: all 0.3s ease;
  }

  .hidden {
    display: none !important;
  }
</style>
