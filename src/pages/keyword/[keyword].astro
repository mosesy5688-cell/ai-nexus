---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ModelCard from '@/components/ModelCard.astro';
import AdSlot from '@/components/AdSlot.astro';
import models from '@/data/models.json';
import keywords from '@/data/keywords.json';
import type { Model } from '@/types';

export async function getStaticPaths() {
  // Generate a page for each discovered keyword
  return keywords.map(keyword => ({
    params: { keyword: keyword.slug },
    props: { keyword },
  }));
}

const { keyword } = Astro.props;
const keywordSlug = keyword?.slug ?? '';
const keywordTitle = keyword?.title ?? 'Unknown';

// Filter models that have the current keyword in their tags array
const relevantModels: Model[] = models.filter(model => 
  Array.isArray(model.tags) && model.tags.map(tag => tag.toLowerCase()).includes(keywordSlug.toLowerCase())
);
---
<BaseLayout title={`Top AI Models for ${keywordTitle}`} description={`Explore the best open-source AI models for ${keywordTitle}.`}>
  <main class="container mx-auto px-4 py-8">
    <div class="mb-8">
      <a href="/#categories" class="text-blue-500 hover:underline">&larr; Back to Categories</a>
    </div>
    <article class="prose dark:prose-invert max-w-none mb-12 text-center">
        <h1 class="text-4xl font-bold">{`AI Models for ${keywordTitle}`}</h1>
        <p class="text-lg">{`Browse our collection of ${relevantModels.length} models related to ${keywordTitle}.`}</p>
    </article>

    <!-- Ad Slot for Keyword Pages -->
    <AdSlot type="google" googleAdClient="ca-pub-YOUR_ID" googleAdSlot="YOUR_KEYWORD_PAGE_SLOT" className="my-12 text-center" />

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {relevantModels.map(model => <ModelCard model={model} />)}
    </div>
  </main>
</BaseLayout>