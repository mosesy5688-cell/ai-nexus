---
export const prerender = false;

import Layout from '../../layouts/Layout.astro';
import ModelCarousel from '../../components/ModelCarousel.astro';
import SimilarModels from '../../components/SimilarModels.astro';
import { getModelBySlug } from '../../utils/db';
import { prepareDetailData, getBestDescription, formatMetric, formatRelativeTime } from '../../utils/frontend-data';

const { slug } = Astro.params;

let model = null;
let rawModel = null;
let relatedModels = [];
let error = null;
let pageTitle = "AI Model Details - Free AI Tools";
let pageDescription = "Explore comprehensive information about this AI model.";

// Fetch model data
try {
  if (!slug) throw new Error("No slug provided");

  rawModel = await getModelBySlug(slug, Astro.locals);
  
  if (rawModel) {
    // Fetch candidate models for similarity check
    let candidateModels = [];
    const db = Astro.locals?.runtime?.env?.DB;
    
    if (db) {
      try {
        // Fetch top 100 models by downloads to serve as a pool for finding similar models
        // This is a performance compromise to avoid fetching ALL models
        const stmt = db.prepare('SELECT * FROM models ORDER BY downloads DESC LIMIT 100');
        const { results } = await stmt.all();
        candidateModels = results || [];
      } catch (e) {
        console.warn("Candidate models fetch failed:", e);
      }
    }

    model = prepareDetailData(rawModel, candidateModels);
    
    // Fetch related models with fallback
    if (db) {
      try {
        let results = [];
        // 1. Try fetching by pipeline tag
        if (model.pipeline_tag) {
            const stmt = db.prepare(`
            SELECT id, name, author, likes, downloads, cover_image_url, description, pipeline_tag
            FROM models
            WHERE pipeline_tag = ? AND id != ?
            ORDER BY downloads DESC
            LIMIT 6
            `);
            const data = await stmt.bind(model.pipeline_tag, model.id).all();
            results = data.results || [];
        }

        // 2. Fallback to popular models if no related found
        if (results.length === 0) {
            const stmt = db.prepare(`
            SELECT id, name, author, likes, downloads, cover_image_url, description, pipeline_tag
            FROM models
            WHERE id != ?
            ORDER BY downloads DESC
            LIMIT 6
            `);
            const data = await stmt.bind(model.id).all();
            results = data.results || [];
        }
        relatedModels = results;
      } catch (e) {
        console.warn("Related models fetch failed:", e);
      }
    }
    
    // Set SEO metadata
    pageTitle = `${model.displayName} by ${model.author} — Free AI Tools`;
    pageDescription = getBestDescription(model).substring(0, 160);
  }
} catch (e) {
  console.error("Error in model detail page:", e);
  error = e;
}

// Safely parse tags into an array for use in the template
let tagsArray = [];
try {
  if (model?.tags && typeof model.tags === 'string') {
    tagsArray = JSON.parse(model.tags);
  }
} catch (e) { console.warn("Tags parse error:", e); }
// Prepare resource links
let resourceLinks = [];
try {
  if (model?.source_url) {
    resourceLinks.push({ label: 'Source Code', url: model.source_url, icon: 'github' });
  }
  if (model?.links_data) {
    if (model.links_data.docs_url) {
      resourceLinks.push({ label: 'Documentation', url: model.links_data.docs_url, icon: 'docs' });
    }
    if (model.links_data.demo_url) {
      resourceLinks.push({ label: 'Live Demo', url: model.links_data.demo_url, icon: 'demo' });
    }
  }
} catch (e) {
  console.warn("Resource links parse error:", e);
}

// Parse resources (files)
let parsedResources = [];
try {
  if (model?.resources && model.resources !== '[]') {
    const parsed = typeof model.resources === 'string' ? JSON.parse(model.resources) : model.resources;
    if (Array.isArray(parsed)) parsedResources = parsed;
  }
} catch (e) {
  console.warn("Resources parse error:", e);
}
---

<Layout title={pageTitle} description={pageDescription}>
  <main class="min-h-screen bg-gray-50 dark:bg-gray-900">
    {error ? (
      <div class="container mx-auto px-4 py-12 text-center">
        <div class="bg-red-50 text-red-800 p-8 rounded-lg max-w-2xl mx-auto">
          <h1 class="text-3xl font-bold mb-4">Error Loading Model</h1>
          <p class="text-gray-600 mb-6">We couldn't fetch the details for this model. It might be a temporary issue or the model does not exist.</p>
          <a href="/explore" class="inline-block bg-indigo-600 text-white font-bold py-2 px-4 rounded hover:bg-indigo-700">Back to Explore</a>
          {error && <pre class="mt-4 text-left text-xs bg-gray-100 p-4 rounded overflow-auto">{error.message}</pre>}
        </div>
      </div>
    ) : model ? (
      <article itemscope itemtype="http://schema.org/SoftwareApplication">
        <div class="container mx-auto px-4 py-12">
          <div class="max-w-7xl mx-auto">
            {/* Breadcrumb */}
            <nav class="mb-6">
              <ol class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
                <li><a href="/" class="hover:text-indigo-600 dark:hover:text-indigo-400">Home</a></li>
                <li><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg></li>
                  <li><a href="/explore" class="hover:text-indigo-600 dark:hover:text-indigo-400">Models</a></li>
                  <li><svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg></li>
                  <li><span class="text-gray-900 dark:text-white font-medium truncate max-w-[200px]" itemprop="name">{model.displayName}</span></li>
                </ol>
              </nav>

              {/* Title & Header Info */}
            <div class="flex flex-col md:flex-row gap-6 items-start">
              {model.cover_image_url && (
                <img src={model.cover_image_url} alt={`${model.displayName} icon`} class="w-24 h-24 rounded-2xl object-cover shadow-lg ring-1 ring-gray-200 dark:ring-gray-700" itemprop="image" />
              )}
              <div class="flex-1">
                <h1 class="text-3xl md:text-5xl font-bold text-gray-900 dark:text-white mb-3 tracking-tight">
                  {model.displayName}
                </h1>
                <p class="text-lg text-gray-600 dark:text-gray-300 flex items-center gap-2">
                  by <span class="font-semibold text-gray-900 dark:text-white" itemprop="author">{model.author}</span>
                  {model.pipeline_tag && (
                    <>
                      <span class="text-gray-300 dark:text-gray-600">•</span>
                      <span class="px-3 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-800 dark:text-indigo-300 rounded-full text-sm font-medium">
                        {model.pipeline_tag}
                      </span>
                    </>
                  )}
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* Main Content Grid */}
        <div class="container mx-auto px-4 py-12">
          <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              
              {/* Left Column: Main Content (2/3) */}
              <div class="md:col-span-2 space-y-8">
                
                {/* Description & Metadata Integration */}
                <section class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-8">
                  <div class="flex items-center gap-3 mb-6 border-b border-gray-100 dark:border-gray-700 pb-4">
                    <div class="p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg">
                        <svg class="w-6 h-6 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">About this Model</h2>
                  </div>
                  
                  {/* Integrated Metadata List */}
                  <div class="mb-8 p-5 bg-gray-50 dark:bg-gray-900/50 rounded-xl border border-gray-100 dark:border-gray-700">
                    <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <li class="flex items-start gap-2">
                            <span class="text-sm font-semibold text-gray-500 dark:text-gray-400">License:</span>
                            <span class="text-sm font-medium text-gray-900 dark:text-white">{model.license || "Unknown"}</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-sm font-semibold text-gray-500 dark:text-gray-400">Library:</span>
                            <span class="text-sm font-medium text-gray-900 dark:text-white">{model.library_name || "Transformers"}</span>
                        </li>
                         {/* Extracting 'arxiv' tags if any */}
                        {tagsArray.filter(t => t.startsWith('arxiv:')).map(tag => (
                            <li class="flex items-start gap-2">
                                <span class="text-sm font-semibold text-gray-500 dark:text-gray-400">Arxiv:</span>
                                <a href={`https://arxiv.org/abs/${tag.split(':')[1]}`} target="_blank" class="text-sm font-medium text-blue-600 hover:underline">{tag.split(':')[1]}</a>
                            </li>
                        ))}
                        {/* Extracting 'dataset' tags if any */}
                        {tagsArray.filter(t => t.startsWith('dataset:')).slice(0, 3).map(tag => (
                            <li class="flex items-start gap-2">
                                <span class="text-sm font-semibold text-gray-500 dark:text-gray-400">Dataset:</span>
                                <span class="text-sm font-medium text-gray-900 dark:text-white truncate">{tag.split(':')[1]}</span>
                            </li>
                        ))}
                    </ul>
                  </div>

                  <div class="prose prose-lg dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed" itemprop="description">
                    <p class="whitespace-pre-wrap">{model.displayDescription}</p>
                  </div>
                  
                  {/* SEO Enhancement Indicator */}
                  {model.seo_status === 'done' && model.seo_summary && (
                    <div class="mt-8 p-4 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-xl flex items-start gap-3">
                      <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                      </svg>
                      <p class="text-sm text-emerald-700 dark:text-emerald-300">
                        ✨ <strong>Enhanced Description:</strong> This model description has been optimized with AI-generated summaries for better clarity and discoverability.
                      </p>
                    </div>
                  )}
                </section>

                {/* Usage Example Section */}
                <section class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-8">
                    <div class="flex items-center justify-between mb-6 border-b border-gray-100 dark:border-gray-700 pb-4">
                         <div class="flex items-center gap-3">
                            <div class="p-2 bg-purple-50 dark:bg-purple-900/30 rounded-lg">
                                <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Usage Example</h2>
                        </div>
                    </div>
                    
                    <div class="relative group" x-data="{ copied: false }">
                        <div class="absolute top-4 right-4 z-10">
                            <button 
                                @click="navigator.clipboard.writeText($refs.codeBlock.innerText); copied = true; setTimeout(() => copied = false, 2000)"
                                class="flex items-center gap-2 px-3 py-1.5 bg-gray-800 text-white text-xs font-medium rounded-md hover:bg-gray-700 transition-colors shadow-sm"
                            >
                                <svg x-show="!copied" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/></svg>
                                <svg x-show="copied" class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                                <span x-text="copied ? 'Copied!' : 'Copy'"></span>
                            </button>
                        </div>
                        <pre class="bg-gray-900 text-gray-100 p-6 rounded-xl overflow-x-auto text-sm font-mono leading-relaxed shadow-inner"><code x-ref="codeBlock">
from transformers import pipeline

# Load the model
pipe = pipeline("{model.pipeline_tag || 'text-generation'}", model="{model.id}")

# Run inference
result = pipe("Hello, world!")
print(result)
                        </code></pre>
                    </div>
                </section>

                {/* Resources & Files */}
                {parsedResources.length > 0 && (
                  <section class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-8">
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                      <svg class="w-5 h-5 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
                      </svg>
                      Available Resources
                    </h3>
                    <ul class="space-y-3">
                      {parsedResources.map((resource) => (
                        <li class="flex items-start gap-3 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-900 transition-colors">
                          <svg class="w-5 h-5 text-gray-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                          </svg>
                          <div class="flex-1 min-w-0">
                            <a href={resource.url} target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline font-medium break-all">
                              {resource.url}
                            </a>
                            {resource.files && resource.files.length > 0 && (
                              <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                Contains {resource.files.length} file{resource.files.length !== 1 ? 's' : ''}
                              </p>
                            )}
                          </div>
                        </li>
                      ))}
                    </ul>
                  </section>
                )}
              </div>

              {/* Right Column: Sticky Sidebar (1/3) */}
              <div class="space-y-6">
                <div class="sticky top-24 space-y-6">
                    
                    {/* Primary CTA Card */}
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-6">
                        <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Get Started</h3>
                        
                        {model.link_status === 'dead' ? (
                            <div class="w-full px-6 py-4 bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 font-bold text-lg rounded-xl text-center cursor-not-allowed mb-4 border border-gray-200 dark:border-gray-600">
                                <span class="flex items-center justify-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                    Link Unavailable
                                </span>
                                <p class="text-xs font-normal mt-1">Source link reported as broken</p>
                            </div>
                        ) : (
                            <a 
                                href={model.source_url} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                class="flex items-center justify-center w-full px-6 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold text-lg rounded-xl transition-all shadow-md hover:shadow-xl transform hover:-translate-y-0.5 mb-4"
                            >
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                                Download Model
                            </a>
                        )}
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div class="p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                                <div class="text-2xl font-bold text-gray-900 dark:text-white">{model.formattedDownloads}</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Downloads</div>
                            </div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                                <div class="text-2xl font-bold text-red-500">{model.formattedLikes}</div>
                                <div class="text-xs text-gray-500 uppercase tracking-wide font-semibold">Likes</div>
                            </div>
                        </div>
                    </div>

                    {/* Social Sharing */}
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-4">Share this Model</h3>
                        <div class="flex gap-2 justify-between">
                            <a href={`https://twitter.com/intent/tweet?text=Check out ${model.displayName} on Free2AITools&url=https://free2aitools.com/model/${slug}`} target="_blank" class="p-3 bg-gray-100 dark:bg-gray-700 hover:bg-black hover:text-white rounded-lg transition-colors" aria-label="Share on X">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                            </a>
                            <a href={`https://www.facebook.com/sharer/sharer.php?u=https://free2aitools.com/model/${slug}`} target="_blank" class="p-3 bg-gray-100 dark:bg-gray-700 hover:bg-blue-600 hover:text-white rounded-lg transition-colors" aria-label="Share on Facebook">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                            </a>
                            <a href={`https://www.reddit.com/submit?url=https://free2aitools.com/model/${slug}&title=${model.displayName}`} target="_blank" class="p-3 bg-gray-100 dark:bg-gray-700 hover:bg-orange-600 hover:text-white rounded-lg transition-colors" aria-label="Share on Reddit">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/></svg>
                            </a>
                            <a href={`https://www.linkedin.com/sharing/share-offsite/?url=https://free2aitools.com/model/${slug}`} target="_blank" class="p-3 bg-gray-100 dark:bg-gray-700 hover:bg-blue-700 hover:text-white rounded-lg transition-colors" aria-label="Share on LinkedIn">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
                            </a>
                        </div>
                    </div>

                    {/* Technical Details */}
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
                        <h3 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-4">Technical Details</h3>
                        <dl class="space-y-3">
                            <div class="flex justify-between">
                                <dt class="text-sm text-gray-600 dark:text-gray-400">Model ID</dt>
                                <dd class="text-sm font-mono text-gray-900 dark:text-white truncate max-w-[150px]" title={model.id}>{model.id}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm text-gray-600 dark:text-gray-400">Last Updated</dt>
                                <dd class="text-sm font-medium text-gray-900 dark:text-white">{model.relativeTime}</dd>
                            </div>
                            <div class="flex justify-between">
                                <dt class="text-sm text-gray-600 dark:text-gray-400">Created</dt>
                                <dd class="text-sm font-medium text-gray-900 dark:text-white">{model.created_at ? formatRelativeTime(model.created_at) : 'Unknown'}</dd>
                            </div>
                        </dl>
                    </div>

                </div>
              </div>

            </div>

            {/* Similar Models (Tag-based) */}
            <SimilarModels models={model.similarModels} />

            {/* Related Models (Pipeline-based) */}
            <section class="mt-20 border-t border-gray-200 dark:border-gray-700 pt-12">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-3">
                  <svg class="w-8 h-8 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"/>
                  </svg>
                  {relatedModels.length > 0 && !model.pipeline_tag ? "Popular Models" : "Related Models"}
                </h2>
                <ModelCarousel models={relatedModels} />
            </section>

          </div>
        </div>

        {/* Schema.org Structured Data */}
        <script type="application/ld+json" set:html={JSON.stringify({
          "@context": "https://schema.org",
          "@type": "SoftwareApplication",
          "name": model.displayName,
          "description": pageDescription,
          "author": {
            "@type": "Person",
            "name": model.author
          },
          "applicationCategory": model.pipeline_tag || "AI Model",
          "operatingSystem": "Cross-platform",
          "softwareVersion": model.last_updated,
          "aggregateRating": model.likes > 0 ? {
            "@type": "AggregateRating",
            "ratingValue": Math.min(5, (model.likes / 1000) + 3),
            "ratingCount": model.likes
          } : undefined,
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          },
          "url": `https://free2aitools.com/model/${slug}`
        })} />

      </article>
    ) : (
      <div class="container mx-auto px-4 py-12 text-center">
        <div class="bg-yellow-50 text-yellow-800 p-8 rounded-lg max-w-2xl mx-auto">
          <h1 class="text-3xl font-bold mb-4">Model Not Found</h1>
          <p class="text-gray-600">The model you are looking for could not be found. It may have been moved or deleted.</p>
        </div>
      </div>
    )}
  </main>
</Layout>

<style>
  /* Smooth transitions */
  * {
    transition-property: background-color, border-color, color, fill, stroke, transform, box-shadow;
    transition-duration: 200ms;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Custom scrollbar for code blocks */
  pre::-webkit-scrollbar {
    height: 0.5rem;
    width: 0.5rem;
  }
  
  pre::-webkit-scrollbar-track {
    background-color: rgba(31, 41, 55, 0.5);
    border-radius: 0.5rem;
  }
  
  pre::-webkit-scrollbar-thumb {
    background-color: rgba(75, 85, 99, 0.8);
    border-radius: 9999px;
  }
</style>